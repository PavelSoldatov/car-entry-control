# Документация к API

### REST c префиксом /ui(пользовательские методы)

Данные методы предназначены для сотрудников предприятия, которые осуществляют администрование зоны вьезда/выезда(создание, удаление, заполнение информации закрепленной за rfid меткой), просмотр журнала событий(создание, изменение, блокировка rfid меток).

Охранникам будет доступна функция принудительного открытия шлагбаума(для кейса, когда rfid метку не удалось считать), просмотр журнала событий(вьезд, выезд).

---

### Методы для пользователя с ролью Администратор-Rfid
#### Создание автомобиля - `POST /ui/car/create`
данный метод создает новую сущность автомобиля, которую впоследствии можно будет привязать к *rfid-метке*.

**Список параметров:**
```json
{
  "carColour": "string",
  "carModel": "string",
  "governmentNumber": "string"
}
```
**Формат ответа:**
```sh
без параметров
```
**Статус:**
```sh
при успешном отрабатывании - HttpStatus.OK
```
#### Привязка ранее созданой rfid-метки к существующему автомобилю - `POST ui/rfid/createCarAndLinkRfid`
Данный метод создает сущность *car* и прикрепляет её к сущности *rfid*. Он необходим для того, чтобы создать машину и привязать её к метке. Других способов внести машину в систему нет.

**Список параметров:**
@RequestParam Long rfidId

```json
{
  "carColour": "string",
  "carModel": "string",
  "governmentNumber": "string"
}
```
**Формат ответа:**
```sh
без параметров
```
**Статус:**
```sh
при успешном отрабатывании - HttpStatus.NO_CONTENT
```
#### блокировка rfid метки  - `POST ui/rfid/blockRfid/{rfidId}`
данный метод нужен для временной (когда водитель находится на больничном или в отпуске) или постоянной блокировки(на случай когда rfid метка начала работать некорректно) ранее созданной rfid метки.

**Список параметров:**
```json
rfidId - long (передается через строку url)
```
**Формат ответа:**
```sh
без параметров
```
**Статус:**
```sh
при успешном отрабатывании - HttpStatus.NO_CONTENT
```
---

#### Обновление rfid метки - `POST ui/rfid/edit`
Метод для обновления полей рфид метки 

**Список параметров**

```sh
{
  "rfid_value": Long, - значение рфид метки, которую изменяют
  "government_number": String, - номер машины, которая привязана к метке
  "car_model": String, - модель машины, которая привязана к метке
  "new_rfid_label": Long - новое значение рфид метки
}
```

**Формат ответа**
HttpStatus.NO_CONTENT

---

#### Обнуление rfid метки - `POST ui/rfid/resetRfid/{rfidId}`
Метод для установки статуса рфид метки в NEW, при условии, что метка находится в статусе ACTIVE или NO_ACTIVE

**Список параметров**
`@PathVariable Long rfidId` - номер изменяемой метки

**Формат ответа**
HttpStatus.OK

---

#### Удаление метки - `DELETE ui/rfid/deleteRfid/{rfidId}`
Метод для удаления рфид метки по рфид ID

**Список параметров**
`@PathVariable Long rfidId` - номер изменяемой метки

**Формат ответа**
HttpStatus.OK

---

#### Деактивация рфид метки - `POST ui/rfid/deactivateUntil`
Метод для деактивации рфид метки до определенной даты, которая указывается в переменных запроса. В приложении существует
фоновая задача, которая самостоятельно обновить статус в ACTIVE как только текущая дата станет больше чем дата из запроса

**Список параметров**
`@RequestParam Date dateUntilDeactivated` - дата в формате yyyy-MM-dd'T'HH:mm:ss
`@RequestParam Long rfidLabelId` - номер изменяемой метки

**Формат ответа**
HttpStatus.OK

---

### Методы для пользователя с ролью Оператор зоны въезда

#### принудительное открытие шлагбаума  - `POST ui/forceOpen`

данный метод нужен для принудительного открытия шлагбаума. на фронте скорей всего будет схемка, с расположением шлагбаумов(нужно продумать этот момент), охранник выбирает нужный шлагбаум, далее открывается форма, где он заполняет номер проезжающего автомибиля и тип события(вьезд или выезд).

**Список параметров:**
```json
gosNumber - string (передается через строку url),
deviceNumber - string,
eventType - string
```
**Формат ответа:**
```sh
без параметров
```
**Статус:**
```sh
при успешном отрабатывании - HttpStatus.NO_CONTENT
```
---
### Общие методы для пользователей с ролями (Оператор зоны въезда и Администратор rfid-меток)
#### просмотр журнала произошедших событий  - `GET ui/rfid/entryEvents`
данный метод позволяет получать список произошедших событий.
**Список параметров:**
```json
без параметров
```
**Формат ответа:**
```sh
на стадии проработки
```
**Статус:**
```sh
при успешном отрабатывании - HttpStatus.OK
```
### Технические методы
#### просмотр журнала произошедших событий  - `GET /topic/newrfidlabel`

данный метод работает по принципу sub и pub при создании новой rfid метки, он оповещает пользователя о том, что появилась новая метка и ее необходимо дозаполнить нужной информацией, прикрепить к существующему автомобилю, для того чтобы перевести в рабочее состояние.

---

### Общие требования к ui(frontend)
1. необходимо сделать точку входа(форму для ввода логина и пароля)
2. концепция должна быть построена по принципу, который в дальнейшем позволит без проблем расширить как текущий функционал, так и добавить новый модуль(другой блока функционала не относящегося к rfid меткам)
3. личный кабинет на данном этапе прорабатывать не нужно, достаточно простого отображение в углу с ролью пользователя.

### методы которые находятся в проработке
1. удаление, просмотр созданных автомобилей(для роли Администратор rfid).
2. просмотр списка rfid-меток.
